

statement ok
set datafusion.execution.batch_size = 8;

statement ok
CREATE EXTERNAL TABLE agg_order (
c1 INT NOT NULL,
c2 varchar NOT NULL,
)
STORED AS CSV
LOCATION '../core/tests/data/aggregate_mixed_type.csv'
OPTIONS ('format.has_header' 'true');

query ITI rowsort
select c1, c2, count(*) from agg_order group by c1, c2;
----
1 'a' 2
2 'b' 2
3 'c' 4
4 'd' 3
5 'e' 1
6 'f' 1
7 'g' 1
8 'a' 1
9 'b' 1

query TT
explain select c1, c2, count(*) from agg_order group by c1, c2;
----
logical_plan
01)Aggregate: groupBy=[[agg_order.c1, agg_order.c2]], aggr=[[count(Int64(1)) AS count(*)]]
02)--TableScan: agg_order projection=[c1, c2]
physical_plan
01)AggregateExec: mode=FinalPartitioned, gby=[c1@0 as c1, c2@1 as c2], aggr=[count(*)]
02)--CoalesceBatchesExec: target_batch_size=8
03)----RepartitionExec: partitioning=Hash([c1@0, c2@1], 4), input_partitions=4
04)------AggregateExec: mode=Partial, gby=[c1@0 as c1, c2@1 as c2], aggr=[count(*)]
05)--------RepartitionExec: partitioning=RoundRobinBatch(4), input_partitions=1
06)----------CsvExec: file_groups={1 group: [[WORKSPACE_ROOT/datafusion/core/tests/data/aggregate_mixed_type.csv]]}, projection=[c1, c2], has_header=true
