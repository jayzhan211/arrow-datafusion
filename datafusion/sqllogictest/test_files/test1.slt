
statement ok
set datafusion.execution.target_partitions = 1;

# Make sure the query run in multiple partitions
statement ok
set datafusion.execution.batch_size = 2;

statement ok
CREATE EXTERNAL TABLE agg_order (
    c1 VARCHAR,
    c2 FLOAT
)
STORED AS CSV
LOCATION '../core/tests/data/data.csv'
OPTIONS ('format.has_header' 'true');

query TR
select * from agg_order;
----
'a' 1.1

query error
select c2, sum(DISTINCT c1) from agg_order group by c2;
----
DataFusion error: Error during planning: Execution error: User-defined coercion failed with Execution("Sum not supported for Utf8") No function matches the given name and argument types 'sum(Utf8)'. You might need to add explicit type casts.
	Candidate functions:
	sum(UserDefined)



statement ok
set datafusion.execution.batch_size = 8192;

query error
select c2, sum(DISTINCT c1) from agg_order group by c2;
----
DataFusion error: Error during planning: Execution error: User-defined coercion failed with Execution("Sum not supported for Utf8") No function matches the given name and argument types 'sum(Utf8)'. You might need to add explicit type casts.
	Candidate functions:
	sum(UserDefined)


statement ok
drop table agg_order

# statement ok
# create table t(a int, b varchar) as values (1, 'ac'), (2, 'ac'), (2, 'ac'), (4, 'b'), (4, 'a'), (3, 'a'), (3, 'ac'), (-6, 'ac'), (5, 'ac'), (5, 'a'), (3, null), (3, null), (4, null), (null,null),(null, 'a');

# query TI
# select b, sum(DISTINCT a) from t group by b;
