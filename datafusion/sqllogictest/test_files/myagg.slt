# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# create a table for testing
statement ok
CREATE TABLE sales_global (zip_code INT,
          country VARCHAR(3),
          sn INT,
          ts TIMESTAMP,
          currency VARCHAR(3),
          amount FLOAT
        ) as VALUES
          (0, 'AGRC', 0, '2022-01-01 06:00:00'::timestamp, 'EUR', 30.0),
          (1, 'FRA', 1, '2022-01-01 08:00:00'::timestamp, 'EUR', 50.0),
          (1, 'TUR', 2, '2022-01-01 11:30:00'::timestamp, 'TRY', 75.0),
          (1, 'FRA', 3, '2022-01-02 12:00:00'::timestamp, 'EUR', 200.0),
          (1, 'TURA', 4, '2022-01-03 10:00:00'::timestamp, 'TRY', 100.0),
          (0, 'AGRC', 4, '2022-01-03 10:00:00'::timestamp, 'EUR', 80.0)


# Run order-sensitive aggregators in multiple partitions
statement ok
set datafusion.execution.target_partitions = 8;

#query error DataFusion error: External error: External error: Arrow error: Invalid argument error: Incorrect number of arrays for StructArray fields, expected 2 got 1
#SELECT country, ARRAY_AGG(amount ORDER BY amount ASC, ts ASC)
#  FROM sales_global
#  GROUP BY country
#  ORDER BY country
